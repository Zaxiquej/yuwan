<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>影之诗猜卡（beta)</title>
    <link rel="stylesheet" type="text/css" href="guess.css">
</head>
<body>
  <div class="title-container">
  <h1>影之诗猜卡（beta）</h1>
  </div>
    <div id="startBox">
      <div id="subStartBox">
        <button id="randomSeedButton">今日谜题种子</button>
        <div class="input-container">
          <input type="text" id="seedInput" placeholder="输入种子">
        </div>
        </div>
      <div class="mode-checkbox">
        <label title="勾选此项以限制卡池仅限指定卡牌与指定卡牌可衍生的 token/无限制卡牌。">
          <input type="checkbox" id="specifiedModeCheckbox">
          指定模式
        </label>
        <label title="勾选此项以限制卡池仅不再出现无法加入卡组的token卡牌（指定模式下不会出现衍生的无限制卡牌）。">
          <input type="checkbox" id="noTokenModeCheckbox">
          无token模式
        </label>
          <label title="勾选此项以在猜卡对象为1000名以后（指定模式为500名）时，依然公开详细名次与相似度。">
          <input type="checkbox" id="lowModeCheckbox">
          低相似度公开
        </label>

        <div class="center-button">
          <button id="useSeedButton">开始游戏</button>
        </div>
      </div>
    </div>
    <!--<button id="puzzleStartButton">解谜开始</button> -->
    <div id="sortingOptions">
        <label for="sortOption">排序选项：</label>
        <select id="sortOption">
          <option value="similarity">根据相似度排序</option>
          <option value="index">根据序号排序</option>
        </select>
        <button id="sortButton">确认排序</button>
        <hr> <!-- 这是分割线 -->
    </div>
  <div id="cSeed">
  <p id="currentSeed">当前种子：</p>
  <p>第10名卡牌相似度：<span id="rank10Similarity">-</span></p>
  <p>第100名卡牌相似度：<span id="rank100Similarity">-</span></p>
  <p>第1000名卡牌相似度：<span id="rank1000Similarity">-</span></p>
</div>
    <div id="playBox">
    <div id="guessBox">
      <hr> <!-- 这是分割线 -->
      <div id="history0"></div>
        <div id="guessContainer">
          <input type="text" id="guessInput" placeholder="输入猜测的卡牌名称">
          <button id="guessButton">确认</button>
        </div>

        <div id="advancedSearchButton">
          <span id="advancedSearchSec">高级搜索</span>
          <span id="toggleIcon">+</span>
        </div>

        <div id="advancedSearch" style="display: none;">
          <table class="advanced-search-table">
            <tr>
              <td>
                <label for="cardType">类型：</label>
                <select id="cardType">
                  <option value="-">-</option>
                  <option value="minion">随从</option>
                  <option value="spell">法术</option>
                  <option value="amulet">护符</option>
                </select>
              </td>

              <td>
                <label for="cost">费用：</label>
                <select id="costComparison">
                  <option value="equal">等于</option>
                  <option value="greater">以上</option>
                  <option value="less">以下</option>
                </select>
                <input type="number" id="cost">
              </td>
            </tr>

            <tr>
              <td id="minionOptions1" style="display: none;">
                <label for="attack">攻击：</label>
                <select id="attackComparison">
                  <option value="equal">等于</option>
                  <option value="greater">以上</option>
                  <option value="less">以下</option>
                </select>
                <input type="number" id="attack">
              </td>

              <td id="minionOptions2" style="display: none;">
                <label for="health">生命值：</label>
                <select id="healthComparison">
                  <option value="equal">等于</option>
                  <option value="greater">以上</option>
                  <option value="less">以下</option>
                </select>
                <input type="number" id="health">
              </td>
            </tr>

            <tr>
              <td>
                <label for="class">职业：</label>
                <select id="class">
                  <option value="-">-</option>
                  <option value="neutral">中立</option>
                  <option value="fairy">妖精</option>
                  <option value="royalguard">皇家护卫</option>
                  <option value="wizard">巫师</option>
                  <option value="dragon">龙族</option>
                  <option value="necromancer">死灵术士</option>
                  <option value="vampire">吸血鬼</option>
                  <option value="bishop">主教</option>
                  <option value="avenger">复仇者</option>
                </select>
              </td>

              <td>
                <label for="rarity">稀有度：</label>
                <select id="rarity">
                  <option value="-">-</option>
                  <option value="rainbow">虹</option>
                  <option value="gold">金</option>
                  <option value="silver">银</option>
                  <option value="bronze">铜</option>
                </select>
              </td>
            </tr>

            <tr>
              <td>
                <label for="race">种族：</label>
                <input type="text" id="race">
              </td>

            </tr>

            <tr>
              <td>
                <label for="description">描述文字：</label>
                <input type="text" id="description">
              </td>
            </tr>
            <tr>
              <td>
                <label for="antiDescription">排除文字：</label>
                <input type="text" id="antiDescription">
              </td>
            </tr>
          </table>
        </div>
    </div>
    <div id="suggestions"></div>
    <hr> <!-- 这是分割线 -->
    <div id="result">
      <span id="guessedCount">0</span> 个被猜测到
    </div>
    <div id="extrahistory">
    </div>
    <div id="history">
      <table id="historyTable">
    <thead>
      <tr>
        <th>#</th>
        <th>卡牌</th>
        <th>相似度</th>
        <th>排名</th>
      </tr>
    </thead>
    <tbody>
      <!-- 历史猜测行将在这里动态添加 -->
    </tbody>
  </table></div>

  <div class="button-container">
    <button id="extraGameButton">猜测前100名</button>
    <a href="https://shadowverse-portal.com/cards?format=1&lang=zh-tw" target="_blank" class="link-button">前往 Shadowverse Portal</a>

    <div class="button-row">
        <button id="hintButton">提示</button>
        <button id="revealButton">揭晓答案</button>
      </div>
  </div>
    <div class="tip-box" id="tipBox">你获得了一个提示</div>
    <div class="warn-box" id="warnBox">你已经猜过这张卡牌了</div>
    <div class="button-container">
    <button id="restartButton">重新开始</button>
    <button id="viewTop100Button">查看前100名</button>
    </div>

<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p id="top100Results"></p>
  </div>
</div>
    </div>

    <div id="fireworks"></div>

<hr> <!-- 这是分割线 -->
    <div id="ruleBox">
       <h2>规则说明</h2>
       <p>1. 选择一个种子，然后点击“开始游戏”按钮，系统会随机抽取一张卡牌作为解谜目标。</p>
       <p>2. 在输入框中输入猜测的卡牌名称，并点击“确认”按钮，系统会告诉你这次猜测的相似度和在所有卡牌中的排名。</p>
       <p>3. 相似度越高，排名越靠前，表示你的猜测与目标卡牌越相似。</p>
       <p>4. 猜错了可以继续猜，直到猜对为止。试试你要几次才能猜到目标卡牌吧！</p>
       <p>5. 由于需要搜索数据库，开始游戏和提示时有卡顿是正常现象。</p>

       <h2>常见问题解答</h2>
       <details>
           <summary>1. 系统会选择哪些卡牌作为解谜目标？</summary>
           <p>系统会从已有的卡牌数据库中随机选择一张卡牌作为解谜目标（包含token，不包含异画）。</p>
           <p>目前数据库截止至：传说复苏，DLC前</p>
           <p>如果你选择了指定模式，那么系统只会选指定模式可能出现的卡（注意，有可能会是一张指定卡衍生的token或无限制卡牌！）。</p>
       </details>
       <details>
           <summary>2. 如果我找不到某个卡牌怎么办？</summary>
           <p>如果找不到相应的卡牌，请检查输入的名称是否正确。数据库来自于shadowverseportal进行简化，因此可能有部分卡名称和国服采用的有出入。</p>
           <p>你可以搜索部分卡名，然后在近似词提示中找你想要的卡牌；如果找不到，或发现卡名出入太大，请联系作者。</p>
           <p>除此之外，你可以使用高级搜索或者portal进行搜索</p>
       </details>
       <details>
           <summary>3. 具体而言，相似度是如何判定的?</summary>
           <p>相似度的判定有三部分：</p>
           <li>基础分：卡牌的类型、种类、费用、稀有度、（如果是随从）进化前的攻击与生命。其中基础分的40%在于两张卡是否是同类型；如果是随从这部分会允给身材。</li>
           <li>技能分：卡牌具有的特殊能力，会检查双方共享能力在双方总能力之中的占比，如果有同能力但数据不同会有相应的扣分。相同的能力如果比较稀有，会有相应的补正。</li>
           <li>描述分：卡牌的描述文字，会检查双方描述文字的Levenshtein距离。在此基础上，如果双方描述有公用部分，则有一个最高30%的补正。</li>
           <p>系统会对这三部分各打一个分，随后按照2:6:2的权重生成总分，满分为100。</p>
       </details>
       <details>
           <summary>4. 卡牌的相似度我所想象的不太一样！</summary>
           <p>嗯，这是可能发生的，这有几种可能性：</p>
           <li>1、对不上的能力是会有扣分的，比如耶拉护符和耶伦毕菈会因为耶伦毕菈有守护和回血，没有最高的相似度。</li>
           <li>2、系统并不能探知卡牌的token，只会对卡牌本身的能力判断（激奏、结晶、抉择变形除外，见下）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比如，矮人技师不会被认为和人偶系的卡牌相似度接近，但是会被认为和抉择拿token的卡牌相似度接近。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同理，尽管随从耶拉会召唤护符耶拉，两者不被认为相似（因为系统不会去检查token）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;特殊地，如果两者拿了相同token（如人偶系）则会有一定程度的加分；而套娃类会和普通制造token有区分。</li>
           <li>3、名字相似甚至复刻角色并不代表卡牌相似度接近。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比如，邪龙‧林德沃姆相似度最近的是重装巨怪。而风之军神‧格里姆尼尔和飓风军神‧格里姆尼尔很接近，却和另外两个风军不太接近。</li>
           <li>4、占字数多的描述会在描述分里有更多影响。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比如，游猎的罪人‧安媞马丽亚会与能制造低费自己的伟大的调停者‧佐伊和死骸金属巨星更接近，而不是具有穿墙疾走的邪龙·林德沃姆。</li>
           <li>5、相似度的判定有三部分（见上），可能你选择的卡在其中一部分有较高的分数，但是就总分的考量偏低。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比如，观星魔女·斯特拉感觉上应该和占星术非常接近，但实际上虽然两者描述分很高，基础分和技能分（观星魔女没有减费能力和土秘）会拉掉很多分。</li>
           <li>6、同特效正反两个方向会被认为接近。比如跳1费和扣1费在判断里其实差的不远。（如果大家对此意见很大可以改）</li>
           <li>7、目前已经做了扳机和任务的判定，但是计数器判定还没做；所以可能会因此无法将一张计数器卡与同类任务卡联系起来（如奥伯龙与深根异种）</li>
           <li>8、待补充</li>
       </details>
       <details>
           <summary>5. 关于激奏、结晶、命运抉择变形</summary>
           <p>这些变形卡牌在对比中，基本分和技能分均会检查原卡和所有变形成的卡，尝试最高的一组配对方式，然后将其总分平均。</p>
           <p>如果数量不符对不上，对不上的部分会减权，且计为0分。最高分有加权，本体对上会有额外加权。</p>
           <p>例：狂舞之刃·蒂欧涅对暴狂士兵时，会激奏2对激奏2，本体对本体；蒂欧涅的激奏7对不上。最终基本分+技能分为激奏2对比分+减权的激奏7得分+加权的本体得分
       </details>
       <details>
           <summary>6. 关于相似度算法</summary>
           <p>相似度算法还在优化中，但是你可以先体验一下游戏（指被拉血压）。</p>
       </details>
       <details>
           <summary>7. 每天生成的种子是固定的吗？</summary>
           <p>是的。如果你想要玩别的，你可以输入之前的种子。</p>
           <p>这么做的理由：</p>
           <li>1、其他猜词游戏也是这么做的（</li>
           <li>2、可以让你和狱友讨论今日卡牌，当然要小心被剧透</li>
           <li>3、如果你暂时卡关了，可以暂停片刻，之后回来继续！</li>
           <p>当然，如果你想玩更多，你可以随便输入一些东西作为种子（种子可以是任何语言，包括中文）！你还可以把你脸滚键盘生成的种子分享给群友（</p>
       </details>
       <details>
           <summary>8. 过去的谜题</summary>
           <p id="functionContent"></p>
       </details>
       <details>
         <summary>9. 更新记录</summary>
         <ul style="list-style-type: none; padding: 0;">
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/12/29</span>更新到了传说复苏，DLC前；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/10/11</span>小幅优化了描述文字判定；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/10/10</span>优化了部分词条判定；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/09/28</span>优化了部分数据库词条读取；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了自残词条判断。

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/09/27</span>更新了新版本内容“变革的恒规”。

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/09/19</span>修复了部分场上随从判定的误判；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了“奶满”词条。

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/09/05</span>调整了自buff判定：减费和增幅类不再归入此类

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/29</span>套娃类重处理：依然算母类，只是额外增加'套娃'词条

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/28</span>优化了部分打分机制；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>可以选择破坏己方（非强制）的也加入了自杀词条。<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>时点不再重复计算。

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/25</span>增加了更多伤害词条的区分；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/23</span>去除了部分贴其他随从buff的“己方战场随从数”词条；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/21</span>优化了部分词条判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>因为算法更先进了，调整了权重；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/20</span>更新了密斯塔尔希亚dlc包；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了重复词条计算<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了部分检查（血量、攻击、费用）词条<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了进化词条，增加了进化自己/其他随从/全体随从的区别<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了名字搜索，完全包含搜索名/被搜索名完全包含/完美符合搜索名会更为前置<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了部分词条的判定机制（数据库是真的乱啊；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/19</span>优化了部分词条判定；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/18</span>优化了激奏结晶的打分标准，现在最高分有额外加权；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了复数词条的打分标准，现在多段同词条可以对上少段同词条，只是溢出部分分数会降为50%；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>少许优化了部分任务词条的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>少许调整了部分词条的加权分；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加额外轮次游戏；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了提示，提示给出的至少会是1000名以内的了（指定模式为500名）；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>现在默认名次1000名开外（指定模式为500名）不显示具体名字和相似度，可以通过勾选开关显示；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了无token模式<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>高级搜索支持空格分割多个文字，增加了排除描述

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/16</span>移除了基础模糊搜索，改为高级搜索；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了吟唱护符吟唱数判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>加强了扭蛋、自回手、奶敌、己方多豆等词条的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>少许优化了部分任务词条的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了重复词条合并的处理

             <li style="margin-left: 20px;">
               <span style="display: inline-block; width: 140px;">2023/08/15</span>优化了部分词条判定；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/14</span>增加了基础模糊搜索；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了几个新的任务和扳机判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>加强了部分计数器和任务的关联；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了搜索鼠标悬浮时看看卡图的功能；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>即使卡名对上也会进行搜索，避免撞上不知名卡牌；

           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/13</span>增加了几个新的任务和扳机判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了“揭露答案”按钮；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了跳转portal的链接；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>猜测与提示的卡也可以前往portal进行确认了；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了指定模式，勾选后卡池仅有指定模式可能出现的卡牌；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了游戏结束后查看前100名的机制。<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>优化了网页UI；

           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/12</span>少许优化了buff类目标的扣分机制；<br>
           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/10</span>少许放宽了正确技能错误条件的扣分；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了部分任务词条与扳机的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了手牌变形、增减脸血上限、脸膜等的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>给部分能力过于独特的卡提供了一些手动补正；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>基础分降低进化后身材的权重，且根据进化时增加的属性值，增加一个"异形身材"词条；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>区分了随从和脸圣盾。<br>
           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/09</span>优化了技能稀有度补正；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了连击、觉醒、余费等词条的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>对部分词条进行了额外区分；现在回费和跳费、瞬念和拉人、破坏和自杀之类的会分开了。<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了“敌我不分”与“大量衍生物（token>4）”词条。<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>改为手动设置技能稀有度补正；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>少许优化数据库文字。
           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/08</span>增加了技能稀有度补正；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了贴主战者/随从效果时，具体效果的判断；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了套娃、回收/复制系的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了触发时点的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>少许优化数据库文字。
           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/07</span>增加了技能目标的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了葬送、土秘、死灵术等cost的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了激奏和结晶的额外判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>增加了增加了自残与亡者召还的判定；<br>
             <span style="display: inline-block; width: 140px; margin-left: 0;"></span>调整了部分权重，增加了同token奖分。
           </li>
           <li style="margin-left: 20px;">
             <span style="display: inline-block; width: 140px;">2023/08/06</span>beta上线
           </li>
         </ul>
       </details>
   </div>

   <div class="footer" id="other">         <li>
         <span> 其他神秘内容 -</span>
           <a href="yuwan.html">听声辨卡部门</a>
           <a href="picGuess.html">卡图部门</a>
           <a href="puzzle.html">关联部门</a>
           <a href="cross.html">分组部门</a>
       </li></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
    <script src="library/database.js"></script>
    <script src="library/subDatabase.js"></script>
    <script src="library/ratioTable.js"></script>
    <script src="SimpTrad.js"></script>
    <script src="similarity.js"></script>
    <script src="guess.js"></script>
</body>
</html>
