<!DOCTYPE html>
<html>
<head>
    <title>数字谜题游戏</title>
    <script>
        // 生成随机整数
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // 自定义阶乘函数
        function factorial(num) {
            if (num === 0 || num === 1) {
                return 1;
            } else {
                return num * factorial(num - 1);
            }
        }

        // 自定义eval函数，支持阶乘（!）乘方（^）开根（r）操作
        function evalExpression(expression) {
            return Function('return ' + expression.replace(/\^/g, '**').replace(/r/g, 'Math.sqrt').replace(/!/g, 'factorial'))();
        }

        // 验证答案是否正确并给出提示
        function checkAnswer() {
            var inputExpression = document.getElementById("inputExpression").value;
            var targetNumber = parseInt(document.getElementById("targetNumber").textContent);
            var userNumber = evalExpression(inputExpression);

            if (userNumber === targetNumber) {
                alert("回答正确！");
            } else {
                var correctExpression = getCorrectExpression(targetNumber);
                alert("回答错误！正确答案是：" + correctExpression);
            }
        }

        // 获取用尽可能少的数字得到目标数字的表达式
        function getCorrectExpression(target) {
            // 简化计算，从2开始尝试数字
            for (var i = 2; i < target; i++) {
                var expression = i.toString();
                for (var j = i + 1; j <= target; j++) {
                    expression += "+" + j;
                    var result = evalExpression(expression);
                    if (result === target) {
                        return expression;
                    }
                }
            }
            return "无解";
        }

        // 随机生成题目
        function generateRandomProblem() {
            var firstNumber = getRandomInt(1, 10); // 第一个数字在1到10之间随机选择
            var targetNumber = getRandomInt(10, 100); // 目标数字在10到100之间随机选择

            // 创建题目并显示
            var problemElement = document.getElementById("problem");
            problemElement.textContent = "用" + firstNumber + "凑出" + targetNumber;

            // 设置目标数字
            var targetNumberElement = document.getElementById("targetNumber");
            targetNumberElement.textContent = targetNumber;

            // 清空输入框
            document.getElementById("inputExpression").value = "";
        }
    </script>
</head>
<body>
    <h1>数字谜题游戏</h1>
    <p id="problem">点击下方按钮开始游戏</p>
    <p>请输入表达式：</p>
    <input type="text" id="inputExpression" placeholder="例如：1+2+3">
    <button onclick="checkAnswer()">提交答案</button>
    <p>目标数字：<span id="targetNumber"></span></p>
    <button onclick="generateRandomProblem()">开始新游戏</button>
</body>
</html>
